<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Template</title>
	</head>

    <body>
      <div class="">
        <button onclick="blancoYnegro();">blanco Y negro</button>
        <input type="file" onchange="cargarImg();" name="name" value="" id="img" >

      </div>
      <canvas id="canvas" width="900" height="600" style="border:#000 solid 1px;" />
    </body>
	<script>
        var ctx = document.getElementById("canvas").getContext("2d");
		    var imagen = new Image();

        //cargo imagen
        function cargarImg(){
        imagen.src = document.getElementById("img").files[0].name;
          imagen.onload=function(){
            ctx.clearRect(0,0,900,600);//vaciar canvas
            myDrawImageMethod(this);
          }

        }

        //dibuja la imagen
        function myDrawImageMethod(img){
        ctx.drawImage(img,0,0);
        }


        //obtengo r,g,b de cada pixel
        function getRed(imageData,x,y){
	      index = (x+y*imageData.width)*4;
	      return imageData.data[index+0];
        }

        function getGreen(imageData,x,y){
	      index = (x+y*imageData.width)*4;
	      return imageData.data[index+1];
        }

        function getBlue(imageData,x,y){
	      index = (x+y*imageData.width)*4;
	      return imageData.data[index+2];
        }

        //aplico el filtro ByN
        function blancoYnegro(){
          imageData = ctx.getImageData(0,0,imagen.width,imagen.height);
          for (y=0 ; y<imagen.height; y++){
            for (x=0; x<imagen.width; x++){
              var pixelbyn=(getRed(imageData,x,y)+getGreen(imageData,x,y)+getBlue(imageData,x,y)/3);
              setPixel(imageData,x,y,pixelbyn,pixelbyn,pixelbyn,255);
        		}
        	}
          //vuelvo a dibujar la img con el filtro aplicado
          ctx.putImageData(imageData,0,0);
        }

        //genero imagen
        function setPixel (imageData,x,y,r,g,b,a){

          index = (x + y * imageData.width) *4 ;
          imageData.data[index+0] =r;
          imageData.data[index+1] =g;
          imageData.data[index+2] =b;
          imageData.data[index+3] =a;
        }

	</script>
</html>
